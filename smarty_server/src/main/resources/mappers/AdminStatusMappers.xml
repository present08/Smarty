<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.smarty.mapper.AdminStatusMapper">

    <select id="getReservation" parameterType="java.util.Map">
        select
        r.reservation_id, c.court_id, c.court_name,
        r.user_id, r.reservation_start, r.reservation_end,
        a.attendance_status
        from reservation r
        left join court c
        on c.court_id=r.court_id
        left join attendance a
        on r.reservation_id=a.reservation_id
        where c.facility_id=#{facility_id} and DATE(r.reservation_start)=#{date};
    </select>
    <select id="getEnrollment" parameterType="java.util.Map">
        select e.enrollment_id, c.class_id, c.class_name,
        c.start_date, c.end_date, c.class_size, count(e.user_id) register
        from enrollment e
        left join class c
        on c.class_id=e.class_id
        and e.enrollment_status="승인완료"
        left join attendance a
        on e.enrollment_id=a.enrollment_id
        where #{date} BETWEEN c.start_date AND c.end_date and c.facility_id=#{facility_id}
        group by c.class_id;
    </select>
    <select id="getAttendance" parameterType="java.util.Map">
        select e.user_id, a.attendance_status, a.checkin_date
        from enrollment e
        join attendance a on a.enrollment_id=e.enrollment_id
        where e.class_id=#{class_id} and DATE(a.checkin_date)=#{date};
    </select>
    <select id="getNewUser" resultType="com.green.smarty.vo.UserVO">
        select * from user
        where join_date BETWEEN #{start} and #{date}
        order by join_date desc;
    </select>
</mapper>